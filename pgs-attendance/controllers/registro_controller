# controllers/registro_controller.py

import face_recognition
import cv2
import os

def comparar_con_kids(image_path, known_faces_dir='kids_faces'):
    try:
        imagen_capturada = face_recognition.load_image_file(image_path)
        codigos_captura = face_recognition.face_encodings(imagen_capturada)

        if not codigos_captura:
            return "No se detectó ningún rostro en la imagen capturada."

        rostro_capturado = codigos_captura[0]

        for archivo in os.listdir(known_faces_dir):
            ruta = os.path.join(known_faces_dir, archivo)
            imagen_bd = face_recognition.load_image_file(ruta)
            codigos_bd = face_recognition.face_encodings(imagen_bd)

            if not codigos_bd:
                continue

            if face_recognition.compare_faces([codigos_bd[0]], rostro_capturado)[0]:
                nombre = os.path.splitext(archivo)[0]
                return f"Rostro identificado: {nombre}"

        return "Rostro no reconocido en la base de datos."
    except Exception as e:
        return f"Error: {str(e)}"

